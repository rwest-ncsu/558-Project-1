---
title: "Project 1"
author: "Robert West"
date: "6/8/2020"
output:
  github_document:
    toc: true
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=F)
knitr::opts_chunk$set(warning=F)
knitr::opts_chunk$set(message=F)
library(ggplot2)
library(jsonlite)
library(tidyverse)
library(knitr)
library(httr)
```

# JSON Data

*Java Script Object Notation* (or JSON) is a text-based data format that is used primarily to send and receive data from internet applications. It is so widely used because its text structure makes it much easier to send files. The "issue" that this can bring with it is that you need to convert the text representation of data into an object that R (or any other language) knows how to work with. JSON structure is nested as shown below. 
```{r}
include_graphics(path="json-example.jpg")
```

This structure allows you to define characteristics of an object that are also allowed to have their own characteristics. While this is extremely flexible, it can be a little difficult to parse yourself. 

# Packages for JSON files in R

Luckily, we don't usually have to parse the data 

The package that I chose to work with is the `jsonlite` package. I chose this because it offers the functionality to return a nested list as a data frame without parsing the data yourself. 






To get a feel for handling JSON data, let's communicate with an API (Application Programming Interface) for the NHL. The URL for accessing the API is saved below and a function for requesting Franchise information is provided to make code more readable. In this function, I utilize: 

* httr::GET() to access a given web address 
* httr::content() to turn the output into a text file 
* jsonlite::fromJSON() to turn the text file into a data frame(with flatten=TRUE)

To access more data from the API, I wrote 4 more functions extraordinarily similar to the `get_franchises()` function but with different URLs. Every API is different, so to determine how to request the right information, you need to read the [documentation](https://gitlab.com/dword4/nhlapi/-/blob/master/records-api.md). 
```{r, echo=T}
base_url = "https://records.nhl.com/site/api"
```



```{r, echo=T}
get_franchises = function(){
  library(jsonlite)
  full_url = paste0(base_url, "/franchise")
  text = content(GET(url=full_url), "text") #Converts the JSON output from the API to a text file
  list_output = fromJSON(text, flatten = T)
  
  return(list_output$data)
}
```



```{r}
get_franchise_totals = function(){
  library(jsonlite)
  full_url = paste0(base_url, "/franchise-team-totals")
  text = content(GET(url=full_url), "text")
  list_output = fromJSON(text, flatten = T)
  
  return(list_output$data)
}
```



```{r}
get_season_records = function(id){
  library(jsonlite)
  full_url = paste0(base_url, "/franchise-season-records?cayenneExp=franchiseId=", id)
  text = content(GET(full_url), "text")
  list_output = fromJSON(text, flatten=T)
  
  return(list_output$data)
}
```



```{r}
get_goalie_records = function(id){
  library(jsonlite)
  full_url = paste0(base_url, "/franchise-goalie-records?cayenneExp=franchiseId=", id)
  text = content(GET(full_url), "text")
  list_output = fromJSON(text, flatten=T)
  
  return(list_output$data)
}
```



```{r}
get_skater_records = function(id){
  library(jsonlite)
  full_url = paste0(base_url, "/franchise-skater-records?cayenneExp=franchiseId=", id)
  text = content(GET(full_url), "text")
  list_output = fromJSON(text, flatten = T)
  
  return(list_output$data)
}
```


Now that we can communicate with the API and can load the data into a data frame, let's explore!
```{r, echo=T}
id=26 #Go 'Canes

franchises = get_franchises()
franchise_totals = get_franchise_totals()
season_records = get_season_records(id)
goalie_records = get_goalie_records(id)
skater_records = get_skater_records(id)

kable(franchises)
```

# Data Exploration

First we examine the idea of a home field advantage. As shown below, it is clear that nearly every team has more home wins than they do road wins since seemingly all points lie above the line `y=x` This certainly doesn't prove that a home field advantage is real, but it might reinforce our belief in one. 
```{r}
ggplot(data=franchise_totals %>% filter(gameTypeId==2), aes(y=homeWins, x=roadWins))+
  geom_point(color="blue")+
  geom_abline(slope=1, intercept = 0, color="red")+
  labs(x="Away Wins", y="Home Wins", title="Scatter of Away vs Home Wins")
```



```{r}
skater_records$avgPointsPerGame = skater_records$points / skater_records$gamesPlayed

ggplot(data=skater_records%>%filter(gameTypeId==2), aes(x=positionCode, y=avgPointsPerGame))+
  geom_boxplot(aes(fill=positionCode))+
  geom_jitter()+
  labs(x="Position", y="Average Points Per Game", fill="Position", title = "Boxplot by Position for the Carolina Hurricanes")
```


```{r}
table = skater_records %>%
  group_by(positionCode)%>%
  summarize(
    count = n(),
    mean = mean(rookiePoints, na.rm = T),
    median = median(rookiePoints, na.rm = T),
    sd = sd(rookiePoints, na.rm = T), 
    max = max(rookiePoints, na.rm = T), 
    min = min(rookiePoints, na.rm = T)
  )
kable(table, caption = "Numeric Summaries of Carlina Hurricanes Rookie Points by Position")
```





























